# Deep learning registration applied on cardiac motion estimation

## Introduction
This repository contains code used in the paper presented in [STACOM workshop, MICCAI 2019](http://stacom2019.cardiacatlas.org/):   
**"Deep Learning for Cardiac Motion Estimation: Supervised vs. Unsupervised Training"**  
You can find the paper and poster in the `paper_poster` directory of this repo.

(Official link to the paper will be made available here once published.)


## Instructions
### Dependencies
All code developed using Python3 (3.6) and deep learning framework Pytorch `1.0`, and tested on Ubuntu 16.04 and 18.04 machines. To install the Python dependencies, run the following in the root directory of the repo after cloning the repo:
```
pip3 install -r requirements.txt
```
CUDA and cuDNN are also required (tested with CUDA `9.0.176` and cuDNN `7.1.4`). Download and instructions can be found from NVIDIA. 


### Running
In general, the code work on a model-directory-basis which means training, testing and inference of a model is based on the model directory of this model. Logs, trained models, evaluation and inference results are all saved in this one directory. 

For example, a basic training run:
```
python train.py --model_dir [path to model dir]
```
then evaluation (computing metrics measuring registration accuracy and deformation regularity), 
```
python eval.py --model_dir [path to model dir]
```
and inference (on all frames of Cardiac MR imaging sequences):
```
python inference.py --model_dir [path to model dir]
```

Some model-related parameters (e.g. supervised/unsupervised) are supplied to the code in a `params.json` file, which should be supplied in the model directory before running. An example of this file is provided under the root directory of this repo. 

## Data
### Cardiac MR data
We used short-axis cardiac MR data from [UK Biobank Imaging Study](https://imaging.ukbiobank.ac.uk/). Please refer to the paper for more details. 

### Ground truth deformation for supervised training
The ground truth deformation were generated by applying Free-form Deformation (FFD) registration using the publicaly available [MIRTK](https://mirtk.github.io/index.html) toolkit, which also provides the tool to convert the registrations to dense displacement fields. This part of the code is not provided in the repo, considering a wide range of registration tools are available. However, we are happy to assit with any issues related to MIRTK. 

## Trained models
Models trained on UK biobank cardiac MR data (unsupervised and supervised) are available. Please email us to enquire if you are interested.

## Contact us
If you have any question regarding the paper or the code, feel free to open an issue in this repo or email us at:
huaqi.qiu15@imperial.ac.uk

